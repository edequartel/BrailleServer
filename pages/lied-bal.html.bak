<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Lied ‚Äì lied-bal</title>

  <link rel="stylesheet" href="../css/style.css">

  <!-- Howler -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>

  <!-- Sounds framework -->
  <script src="../js/sounds.js"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: radial-gradient(circle at top, #e0f2fe, #eef2ff 45%, #f9fafb 100%);
      margin: 0;
      padding: 0;
    }

    .wrapper {
      max-width: 900px;
      margin: 40px auto;
      padding: 16px;
    }

    .card {
      background: #fff;
      border-radius: 22px;
      padding: 28px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.15);
    }

    .header {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .icon {
      width: 62px;
      height: 62px;
      border-radius: 16px;
      background: linear-gradient(135deg,#ec4899,#6366f1);
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      font-size:28px;
    }

    h1 {
      margin: 0;
      font-size: 1.8rem;
    }

    .subtitle {
      color: #6b7280;
      margin-top: 2px;
      margin-bottom: 12px;
    }

    .controls {
      margin-top: 20px;
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .play-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 1rem;
      font-weight: 600;
      background: linear-gradient(135deg,#22c55e,#16a34a);
      color: white;
      display: flex;
      gap: 10px;
      align-items: center;
      cursor: pointer;
    }

    .secondary-btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      background: #e5e7eb;
      color: #374151;
      cursor: pointer;
    }

    .timeline-bar {
      background: #e5e7eb;
      height: 8px;
      border-radius: 999px;
      margin-top: 24px;
      overflow: hidden;
    }

    .timeline-progress {
      height: 8px;
      width: 0%;
      background: linear-gradient(90deg,#3b82f6,#6366f1);
      border-radius: 999px;
    }

    .time-row {
      display: flex;
      justify-content: space-between;
      color: #6b7280;
      margin-top: 6px;
      font-size: 0.8rem;
    }

    .status {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-top: 18px;
      color: #444;
      font-size: 0.85rem;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #9ca3af;
    }

    .playing { background: #22c55e; }
    .paused  { background: #f97316; }
    .idle    { background: #9ca3af; }
    .error   { background: #ef4444; }

  </style>
</head>

<body>
<div class="wrapper">
  <div class="card">

    <div class="header">
      <div class="icon">üéµ</div>
      <div>
        <h1>Lied ‚Äì bal</h1>
        <p class="subtitle">Luister naar het lied ‚Äúlied-bal‚Äù.</p>
      </div>
    </div>

    <p>
      Het geluid komt uit <strong>stories/lied-bal</strong> via
      <code>sounds.json</code> &amp; <code>sounds.js</code>.
    </p>

    <div class="controls">
      <button id="btnPlay" class="play-btn">
        <span id="playIcon">‚ñ∂</span>
        <span id="playLabel">Afspelen</span>
      </button>

      <button id="btnRestart" class="secondary-btn">Opnieuw</button>
    </div>

    <div class="timeline-bar">
      <div id="timelineProgress" class="timeline-progress"></div>
    </div>

    <div class="time-row">
      <span id="currentTime">00:00</span>
      <span id="totalTime">00:00</span>
    </div>

    <div class="status">
      <span id="statusDot" class="dot idle"></span>
      <span id="statusText">Voorbereiden‚Ä¶</span>
    </div>

  </div>
</div>

<script>
  const LANG = "nl";
  const STORY = "lied-bal";

  let howl = null;
  let timer = null;

  function fmt(sec) {
    const m = Math.floor(sec/60);
    const s = Math.floor(sec%60);
    return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  }

  function setStatus(mode, text) {
    document.getElementById("statusDot").className = "dot " + mode;
    document.getElementById("statusText").textContent = text;
  }

  function startTimer() {
    stopTimer();
    timer = setInterval(() => {
      if (!howl) return;
      const pos = howl.seek() || 0;
      const dur = howl.duration() || 0;

      document.getElementById("currentTime").textContent = fmt(pos);
      document.getElementById("totalTime").textContent = fmt(dur);

      const pct = dur ? (pos/dur)*100 : 0;
      document.getElementById("timelineProgress").style.width = pct + "%";
    }, 200);
  }

  function stopTimer() {
    if (timer) clearInterval(timer);
    timer = null;
  }

  async function initAudio() {
    // sounds.json in /config
    await Sounds.init("../config/sounds.json");

    const url = Sounds._buildUrl(LANG, "stories", STORY);

    howl = Sounds._getHowl(url);

    howl.on("load", () => {
      document.getElementById("totalTime").textContent = fmt(howl.duration());
      setStatus("idle", "Klaar om af te spelen");
    });

    howl.on("play", () => {
      document.getElementById("playIcon").textContent = "‚è∏";
      document.getElementById("playLabel").textContent = "Pauzeer";
      setStatus("playing", "Afspelen‚Ä¶");
      startTimer();
    });

    howl.on("pause", () => {
      document.getElementById("playIcon").textContent = "‚ñ∂";
      document.getElementById("playLabel").textContent = "Afspelen";
      setStatus("paused", "Gepauzeerd");
    });

    howl.on("end", () => {
      document.getElementById("playIcon").textContent = "‚ñ∂";
      document.getElementById("playLabel").textContent = "Afspelen";
      setStatus("idle", "Afgelopen");
      stopTimer();
    });
  }

  document.getElementById("btnPlay").onclick = () => {
    if (!howl) return;
    if (howl.playing()) howl.pause();
    else howl.play();
  };

  document.getElementById("btnRestart").onclick = () => {
    if (!howl) return;
    howl.seek(0);
    howl.play();
  };

  window.addEventListener("keydown", ev => {
    if (ev.code === "Space") {
      ev.preventDefault();
      if (!howl) return;
      if (howl.playing()) howl.pause();
      else howl.play();
    }
  });

  window.addEventListener("DOMContentLoaded", initAudio);
</script>

</body>
</html>
