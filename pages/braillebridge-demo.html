<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>BrailleBridge + Sounds Demo</title>

  <!-- Shared stylesheet -->
  <link rel="stylesheet" href="../css/style.css" />

  <!-- Howler.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>

  <!-- Frameworks -->
  <script src="../js/braillebridge.js"></script>
  <script src="../js/sounds.js"></script>
</head>

<body>
  <div class="container">
    <h1>BrailleBridge + Sounds Demo</h1>
    <p class="small">
      Demo-pagina: test BrailleBridge HTTP/WS en het Sounds-framework vanaf
      <code>https://www.tastenbraille.com/braillestudio</code>.
    </p>

    <!-- Connection status -->
    <div id="connectionStatus">WebSocket: nog niet verbonden…</div>

    <!-- HTTP demo -->
    <h2>HTTP → Braille</h2>
    <div class="button-row">
      <button id="btnHello">Stuur "Hallo braille!"</button>
      <button id="btnClear">Maak braille leeg</button>
    </div>

    <!-- Sounds + braille demo -->
    <h2>NL letters + geluid</h2>
    <div class="button-row">
      <button data-letter="a">Letter A</button>
      <button data-letter="b">Letter B</button>
      <button data-letter="k">Letter K</button>
    </div>

    <div class="button-row">
      <button id="btnNlClick">NL UI-click</button>
      <button id="btnSharedCorrect">Shared: correct</button>
    </div>

    <p class="small">
      Cursor-routing en duimtoetsen worden hieronder gelogd.
    </p>

    <!-- Log -->
    <h2>Log</h2>
    <div id="log"></div>
  </div>

  <script>
    // Simple page logger, used by Sounds and BrailleBridge config
    function pageLog(msg) {
      const log = document.getElementById("log");
      const time = new Date().toLocaleTimeString();
      log.textContent += `[${time}] ${msg}\n`;
      log.scrollTop = log.scrollHeight;
      console.log(msg);
    }

    // Update connection status bar
    function setConnectionStatus(text, ok) {
      const el = document.getElementById("connectionStatus");
      el.textContent = "WebSocket: " + text;
      el.style.color = ok ? "green" : "red";
    }

    window.addEventListener("DOMContentLoaded", async () => {
      // --- INIT SOUNDS ------------------------------------------------------
      // we are in /page → config is in ../config
      await Sounds.init("../config/sounds.json", pageLog);

      // --- INIT BRAILLEBRIDGE ----------------------------------------------
      BrailleBridge.setConfig({
        baseUrl: "http://localhost:5000",
        wsUrl: "ws://localhost:5000/ws",
        displayCells: 40,
        debug: true
      });

      BrailleBridge.on("connected", () => {
        setConnectionStatus("verbonden", true);
        pageLog("BrailleBridge: connected");
      });

      BrailleBridge.on("disconnected", (info) => {
        setConnectionStatus("verbinding verbroken", false);
        pageLog("BrailleBridge: disconnected (" + (info.reason || "") + ")");
      });

      BrailleBridge.on("cursor", evt => {
        pageLog("Cursor index=" + evt.index);
      });

      BrailleBridge.on("thumbkey", evt => {
        pageLog("Thumbkey name=" + evt.name + " (lower=" + evt.nameLower + ")");
      });

      BrailleBridge.on("error", err => {
        pageLog("ERROR: " + (err.error || err));
      });

      BrailleBridge.connect();

      // --- BUTTONS: HTTP DEMO ----------------------------------------------
      document.getElementById("btnHello").onclick = () => {
        BrailleBridge.sendText("Hallo braille!").then(r => {
          pageLog("sendText result: " + r.status);
        }).catch(e => {
          pageLog("sendText error: " + e);
        });
      };

      document.getElementById("btnClear").onclick = () => {
        BrailleBridge.clearDisplay()
          .then(r => pageLog("clearDisplay result: " + r.status))
          .catch(e => pageLog("clearDisplay error: " + e));
      };

      // --- BUTTONS: LETTERS NL ---------------------------------------------
      document.querySelectorAll("button[data-letter]").forEach(btn => {
        btn.onclick = () => {
          const letter = btn.getAttribute("data-letter");
          // play sound from server
          Sounds.playLetter("nl", letter);
          // send same letter to braille display (padded)
          BrailleBridge.sendText(letter);
        };
      });

      // --- BUTTONS: UI + shared --------------------------------------------
      document.getElementById("btnNlClick").onclick = () => {
        Sounds.playUI("nl", "click");
      };

      document.getElementById("btnSharedCorrect").onclick = () => {
        Sounds.playShared("correct");
      };
    });
  </script>
</body>
</html>
