<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BrailleStudio - Bartiméus Onderwijs</title>

  <!-- =========================================================
       Bootstrap loader (works in BOTH environments)
       - GitHub Pages: /BrailleServer/js/bootstrap.js
       - Working Copy / local: ./js/bootstrap.js
       ========================================================= -->
  <script>
    (function () {
      var isGh = location.hostname === "edequartel.github.io";
      var src  = isGh ? "/BrailleServer/js/bootstrap.js" : "./js/bootstrap.js";

      var s = document.createElement("script");
      s.src = src;
      s.onload = function(){ console.log("[words.html] bootstrap loaded:", src); };
      s.onerror = function(){
        document.documentElement.innerHTML =
          "<pre style='padding:12px;border:1px solid #c00;'>BOOTSTRAP NOT LOADED: " + src + "</pre>";
      };
      document.head.appendChild(s);
    })();
  </script>

  <!-- BASE-aware CSS (patched by bootstrap.js) -->
  <link rel="stylesheet" href="/components/braille-monitor/braillemonitor.css" data-bs-href />
  <link rel="stylesheet" href="/pages/activity-runner.css" data-bs-href />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" data-bs-href />

  <style>
    .settings-fab{
      position: fixed;
      right: 14px;
      bottom: 14px;
      z-index: 9999;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: 1px solid rgba(127,127,127,.35);
      background: rgba(255,255,255,.10);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      color: inherit;
      text-decoration: none;
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
      cursor: pointer;
      user-select: none;
    }
    html[data-theme="dark"] .settings-fab{
      background: rgba(20,24,36,.55);
      border-color: rgba(255,255,255,.16);
    }
    .settings-fab:hover{ transform: translateY(-1px); }
    .settings-fab:active{ transform: translateY(0); }
  </style>
</head>

<body>
  <!-- Visible diagnostics (remove when stable) -->
  <pre id="diag" style="padding:8px;border:1px solid #ccc;">loading…</pre>
  <script>
    (function(){
      var d = document.getElementById("diag");
      function set(txt){ if (d) d.textContent = txt; }
      window.addEventListener("error", function(e){
        set("JS ERROR:\n" + (e.message || e.error || e));
      });
      set("host=" + location.hostname + "\npath=" + location.pathname);
      document.addEventListener("bootstrap:ready", function(){
        set("bootstrap:ready\nBASE=" + (window.BOOTSTRAP ? window.BOOTSTRAP.BASE : "(missing)"));
      });
    })();
  </script>

  <main class="container" aria-live="polite">
    <div class="braille-panel">
      <div class="word-header">
        <span id="field-emoji" class="word-emoji" aria-hidden="true">–</span>

        <div class="word-line">
          <span id="field-word" class="word-text">–</span>
          <span id="field-word-braille" class="word-braille">–</span>
        </div>
      </div>

      <div class="braille-nav">
        <button id="prev-btn" class="secondary" type="button">prev</button>

        <span class="runner-controls">
          <label class="auto-next">
            <input id="auto-run" type="checkbox" checked />
          </label>
        </span>

        <button id="next-btn" type="button">next</button>
      </div>
    </div>

    <div id="brailleMonitorComponent"></div>

    <p class="field-value" id="activity-instruction">–</p>

    <div class="meta-bar">
      <span id="item-id">ID: –</span>
      <span id="item-index">0 / 0</span>
      <span id="data-status">Data: –</span>
    </div>

    <div class="meta-bar meta-bar-tight">
      <span id="activity-index">0 / 0</span>
      <span id="activity-id">Activity: –</span>
    </div>

    <div class="meta-bar meta-bar-tight">
      <span id="activity-status">Status: idle</span>
    </div>

    <div class="top-controls">
      <div class="top-controls__left">
        <div id="activity-buttons" class="buttons buttons-left"></div>
      </div>

      <div class="top-controls__right">
        <div class="buttons buttons-right">
          <button
            id="toggle-fields-btn"
            class="secondary"
            type="button"
            aria-controls="fields-panel"
            aria-expanded="false">
            Velden
          </button>

          <button id="toggle-log-btn" class="secondary" type="button">Log</button>

          <button
            id="themeToggle"
            class="theme-toggle"
            type="button"
            aria-label="Toggle theme">
            <span class="theme-dot" aria-hidden="true"></span>
            <span id="themeLabel">Theme: light</span>
          </button>
        </div>
      </div>
    </div>

    <section id="fields-panel" class="log-panel hidden" aria-label="Alle velden">
      <div class="log-header">
        <span>Alle velden</span>
      </div>
      <div id="field-all" class="log-body">–</div>
    </section>

    <section id="log-panel" class="log-panel hidden" aria-label="Log">
      <div class="log-header">
        <span>Log</span>
        <span class="log-controls">
          <button id="clear-log-btn" type="button">Clear</button>
        </span>
      </div>
      <div id="log" class="log-body">Log start…</div>
    </section>
  </main>

  <!-- Settings button -->
  <a class="settings-fab" href="/pages/settings.html" data-bs-a aria-label="Settings">⚙</a>

  <!-- Theme + inline logger (unchanged except themeToggle id fix) -->
  <script>
    (function () {
      const THEME_KEY = "bs_theme";
      const html = document.documentElement;

      function applyTheme(theme) {
        html.setAttribute("data-theme", theme);
        const label = document.getElementById("themeLabel");
        if (label) label.textContent = "Theme: " + theme;
      }

      function getInitialTheme() {
        const saved = localStorage.getItem(THEME_KEY);
        if (saved === "light" || saved === "dark") return saved;
        return window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      }

      function appendToPanel(line) {
        const el = document.getElementById("log");
        if (!el) return;
        if (el.textContent === "Log start…") el.textContent = "";
        el.textContent += line + "\n";
        el.scrollTop = el.scrollHeight;
      }

      if (typeof window.logMessage !== "function") {
        window.logMessage = function (msg) {
          appendToPanel(String(msg));
          console.log(msg);
        };
      }

      document.addEventListener("DOMContentLoaded", () => {
        applyTheme(getInitialTheme());

        const tbtn = document.getElementById("themeToggle");
        if (tbtn) {
          tbtn.addEventListener("click", () => {
            const current =
              html.getAttribute("data-theme") === "dark" ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            localStorage.setItem(THEME_KEY, next);
            applyTheme(next);
            window.logMessage("[theme] " + next);
          });
        }

        const btn = document.getElementById("clear-log-btn");
        if (btn) {
          btn.addEventListener("click", () => {
            const el = document.getElementById("log");
            if (el) el.textContent = "";
          });
        }

        const toggle = document.getElementById("toggle-log-btn");
        const panel = document.getElementById("log-panel");
        if (toggle && panel) {
          toggle.addEventListener("click", () => {
            panel.classList.toggle("hidden");
          });
        }
      });

      window.logMessage("[words.html] Inline logger ready.");
    })();
  </script>

  <!-- BASE-aware scripts (bootstrap patches these src attributes) -->
  <script src="/js/logging.js" data-bs-src></script>
  <script src="/js/braillebridge.js" data-bs-src></script>
  <script src="/components/braille-monitor/braillemonitor.js" data-bs-src></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>

  <script src="/js/sounds.js" data-bs-src></script>

  <script src="/activities/tts.js" data-bs-src></script>
  <script src="/activities/letters.js" data-bs-src></script>
  <script src="/activities/words.js" data-bs-src></script>
  <script src="/activities/story.js" data-bs-src></script>
  <script src="/activities/sounds.js" data-bs-src></script>

  <script src="/js/activity-runner.js" data-bs-src></script>
  <script src="/js/words.js" data-bs-src></script>
</body>
</html>