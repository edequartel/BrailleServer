<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Local C# Bridge Test</title>
  <link rel="stylesheet" href=".style/style.css">
</head>

<body>
  <h1>Local C# Bridge Test (HTTP + WebSocket)</h1>

  <div class="button-row">
    <button id="btnHello">HTTP: Stuur testtekst naar /braille</button>
    <button id="btnEcho">HTTP: Stuur eigen tekst naar /braille</button>
  </div>

  <div class="button-row">
    <button id="btnWSConnect">WS: Verbind met WebSocket</button>
    <button id="btnWSSend">WS: Stuur bericht</button>
    <button id="btnWSDisconnect">WS: Verbreek verbinding</button>
  </div>

  <h2>Output</h2>
  <pre id="output"></pre>

  <script>
    // Correct endpoints for your running bridge:
    const baseUrl = "http://localhost:5000";
    const wsUrl   = "ws://localhost:5000/ws";

    const output = document.getElementById("output");
    let ws = null;

    function log(msg) {
      output.textContent += msg + "\n";
      output.scrollTop = output.scrollHeight;
    }

    // -----------------------------
    // HTTP BUTTONS
    // -----------------------------

    // Send default test text to braille
    document.getElementById("btnHello").onclick = async () => {
      try {
        const res = await fetch(`${baseUrl}/braille`, {
          method: "POST",
          headers: { "Content-Type": "text/plain" },
          body: "Hallo vanaf HTML!"
        });
        const txt = await res.text();
        log("[HTTP] POST /braille → " + txt);
      } catch (err) {
        log("[HTTP ERROR] " + err);
      }
    };

    // Send user-entered text to braille
    document.getElementById("btnEcho").onclick = async () => {
      const text = prompt("Welke tekst wil je sturen naar de brailleleesregel?", "Hallo braille!");
      if (!text) return;

      try {
        const res = await fetch(`${baseUrl}/braille`, {
          method: "POST",
          headers: { "Content-Type": "text/plain" },
          body: text
        });
        const txt = await res.text();
        log("[HTTP] POST /braille → " + txt);
      } catch (err) {
        log("[HTTP ERROR] " + err);
      }
    };

    // -----------------------------
    // WEBSOCKET BUTTONS
    // -----------------------------

    document.getElementById("btnWSConnect").onclick = () => {
      if (ws && ws.readyState === WebSocket.OPEN) {
        log("[WS] Already connected");
        return;
      }

      ws = new WebSocket(wsUrl);

      ws.onopen = () => log("[WS] Verbonden met ws://localhost:5000/ws");
      ws.onclose = () => log("[WS] Verbinding gesloten");
      ws.onerror = err => log("[WS ERROR] " + err);
      ws.onmessage = evt => log("[WS] Ontvangen: " + evt.data);
    };

    document.getElementById("btnWSSend").onclick = () => {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        log("[WS] Niet verbonden");
        return;
      }

      const text = prompt("Welk bericht wil je via WebSocket versturen?", "Hallo via WS!");
      if (!text) return;

      ws.send(text);
      log("[WS] Verstuurd: " + text);
    };

    document.getElementById("btnWSDisconnect").onclick = () => {
      if (ws) {
        ws.close();
        log("[WS] Verbinding handmatig gesloten.");
      }
    };
  </script>

</body>
</html>
